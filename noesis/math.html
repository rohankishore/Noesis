<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Noesis - Math</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/mathjs@11.11.0/lib/browser/math.js"></script>
</head>
<body class="h-screen bg-neutral-950 text-neutral-200 font-sans">

<div class="flex flex-col h-full">

    <header class="flex items-center justify-between px-6 py-4 border-b border-neutral-800">
        <h1 class="text-lg tracking-wide font-medium">NOESIS</h1>
        <div class="flex gap-6 text-sm">
            <a href="math.html" class="text-neutral-100 border-b border-neutral-100 pb-1">Math</a>
            <a href="physics.html" class="text-neutral-400 hover:text-neutral-200">Physics</a>
        </div>
    </header>

    <main class="flex flex-1 overflow-hidden">

        <aside class="w-80 border-r border-neutral-800 p-5 overflow-y-auto space-y-2">
            <div id="equations-container"></div>
            <button id="addEquation" class="w-full text-neutral-500 hover:text-neutral-300 text-sm py-2">+ Add equation</button>
        </aside>

        <section class="flex-1 flex flex-col bg-gradient-to-br from-neutral-900 to-black">
            <div class="flex-1 p-8">
                <canvas id="mathGraph"></canvas>
            </div>
        </section>

    </main>

</div>

<script>
let chart = null;
let equations = [];
const colors = [
    'rgb(167, 139, 250)',
    'rgb(249, 115, 22)',
    'rgb(34, 197, 94)',
    'rgb(236, 72, 153)',
    'rgb(59, 130, 246)',
    'rgb(234, 179, 8)'
];

function createEquationInput(initialValue = '') {
    const container = document.createElement('div');
    container.className = 'flex items-center gap-2';
    
    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'flex-1 bg-transparent border-b border-neutral-700 focus:border-neutral-500 p-2 text-base focus:outline-none font-mono';
    input.placeholder = 'x^2';
    input.value = initialValue;
    
    const colorDot = document.createElement('div');
    colorDot.className = 'w-3 h-3 rounded-full flex-shrink-0';
    colorDot.style.backgroundColor = colors[equations.length % colors.length];
    
    const removeBtn = document.createElement('button');
    removeBtn.textContent = 'Ã—';
    removeBtn.className = 'text-neutral-500 hover:text-neutral-200 text-xl w-6 h-6 flex-shrink-0';
    removeBtn.onclick = () => {
        const index = equations.indexOf(eqData);
        if (index > -1) {
            equations.splice(index, 1);
            container.remove();
            plotGraph();
        }
    };
    
    container.appendChild(colorDot);
    container.appendChild(input);
    container.appendChild(removeBtn);
    
    const eqData = { input, color: colorDot.style.backgroundColor };
    equations.push(eqData);
    
    input.addEventListener('input', plotGraph);
    
    return container;
}

function plotGraph() {
    const ctx = document.getElementById('mathGraph').getContext('2d');
    const datasets = [];
    
    for (let i = 0; i < equations.length; i++) {
        const eq = equations[i];
        const equation = eq.input.value.trim();
        
        if (!equation) continue;
        
        try {
            const node = math.parse(equation);
            const code = node.compile();
            
            const domain = { min: -10, max: 10 };
            const data = [];
            const step = (domain.max - domain.min) / 200;
            
            // Extract variables from the parsed expression
            const symbols = node.filter(node => node.isSymbolNode).map(n => n.name);
            const funcs = ['sin', 'cos', 'tan', 'sqrt', 'exp', 'log', 'abs', 'ceil', 'floor', 'round', 'sign', 'ln', 'asin', 'acos', 'atan', 'sinh', 'cosh', 'tanh'];
            const vars = symbols.filter(s => !funcs.includes(s));
            const varName = vars[0] || 'x';
            
            for (let val = domain.min; val <= domain.max; val += step) {
                const scope = {};
                scope[varName] = val;
                
                try {
                    const result = code.evaluate(scope);
                    if (typeof result === 'number' && isFinite(result)) {
                        data.push({ x: val, y: result });
                    }
                } catch (e) {
                    // Skip invalid points
                }
            }
            
            if (data.length > 0) {
                datasets.push({
                    label: equation,
                    data: data,
                    borderColor: eq.color,
                    backgroundColor: eq.color.replace('rgb', 'rgba').replace(')', ', 0.1)'),
                    borderWidth: 2,
                    tension: 0.4,
                    pointRadius: 0
                });
            }
        } catch (error) {
            console.error('Error parsing equation:', equation, error);
        }
    }
    
    if (chart) {
        chart.destroy();
    }
    
    chart = new Chart(ctx, {
        type: 'line',
        data: { datasets },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                x: {
                    type: 'linear',
                    grid: {
                        color: 'rgba(82, 82, 82, 0.3)'
                    },
                    ticks: {
                        color: 'rgb(163, 163, 163)'
                    }
                },
                y: {
                    grid: {
                        color: 'rgba(82, 82, 82, 0.3)'
                    },
                    ticks: {
                        color: 'rgb(163, 163, 163)'
                    }
                }
            }
        }
    });
}

document.getElementById('addEquation').onclick = () => {
    const container = document.getElementById('equations-container');
    container.appendChild(createEquationInput());
};

// Add initial equation
window.addEventListener('load', () => {
    const container = document.getElementById('equations-container');
    container.appendChild(createEquationInput(''));
});
</script>

</body>
</html>
